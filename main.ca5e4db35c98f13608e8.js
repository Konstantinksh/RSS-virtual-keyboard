(()=>{"use strict";const e=[{type:"char",code:"Backquote",key:{Eng:"`",Ru:"Ё"},shift:{Eng:"~",Ru:null}},{type:"digit",code:"Digit1",key:{Eng:"1",Ru:"1"},shift:{Eng:"!",Ru:"!"}},{type:"digit",code:"Digit2",key:{Eng:"2",Ru:"2"},shift:{Eng:"@",Ru:'"'}},{type:"digit",code:"Digit3",key:{Eng:"3",Ru:"3"},shift:{Eng:"#",Ru:"№"}},{type:"digit",code:"Digit4",key:{Eng:"4",Ru:"4"},shift:{Eng:"$",Ru:";"}},{type:"digit",code:"Digit5",key:{Eng:"5",Ru:"5"},shift:{Eng:"%",Ru:"%"}},{type:"digit",code:"Digit6",key:{Eng:"6",Ru:"6"},shift:{Eng:"^",Ru:":"}},{type:"digit",code:"Digit7",key:{Eng:"7",Ru:"7"},shift:{Eng:"&",Ru:"?"}},{type:"digit",code:"Digit8",key:{Eng:"8",Ru:"8"},shift:{Eng:"*",Ru:"*"}},{type:"digit",code:"Digit9",key:{Eng:"9",Ru:"9"},shift:{Eng:"(",Ru:"("}},{type:"digit",code:"Digit0",key:{Eng:"0",Ru:"0"},shift:{Eng:")",Ru:")"}},{type:"char",code:"Minus",key:{Eng:"-",Ru:"-"},shift:{Eng:"_",Ru:"_"}},{type:"char",code:"Equal",key:{Eng:"=",Ru:"="},shift:{Eng:"+",Ru:"+"}},{type:"modifier",code:"Backspace",key:{Eng:"BACKSPACE",Ru:"BACKSPACE"},shift:{Eng:null,Ru:null}},{type:"modifier",code:"Tab",key:{Eng:"TAB",Ru:"TAB"},shift:{Eng:null,Ru:null}},{type:"char",code:"KeyQ",key:{Eng:"Q",Ru:"Й"},shift:{Eng:null,Ru:null}},{type:"char",code:"KeyW",key:{Eng:"W",Ru:"Ц"},shift:{Eng:null,Ru:null}},{type:"char",code:"KeyE",key:{Eng:"E",Ru:"У"},shift:{Eng:null,Ru:null}},{type:"char",code:"KeyR",key:{Eng:"R",Ru:"К"},shift:{Eng:null,Ru:null}},{type:"char",code:"KeyT",key:{Eng:"T",Ru:"Е"},shift:{Eng:null,Ru:null}},{type:"char",code:"KeyY",key:{Eng:"Y",Ru:"Н"},shift:{Eng:null,Ru:null}},{type:"char",code:"KeyU",key:{Eng:"U",Ru:"Г"},shift:{Eng:null,Ru:null}},{type:"char",code:"KeyI",key:{Eng:"I",Ru:"Ш"},shift:{Eng:null,Ru:null}},{type:"char",code:"KeyO",key:{Eng:"O",Ru:"Щ"},shift:{Eng:null,Ru:null}},{type:"char",code:"KeyP",key:{Eng:"P",Ru:"З"},shift:{Eng:null,Ru:null}},{type:"char",code:"BracketLeft",key:{Eng:"[",Ru:"Х"},shift:{Eng:"{",Ru:null}},{type:"char",code:"BracketRight",key:{Eng:"]",Ru:"Ъ"},shift:{Eng:"}",Ru:null}},{type:"char",code:"Backslash",key:{Eng:"\\",Ru:"\\"},shift:{Eng:"|",Ru:"/"}},{type:"modifier",code:"Delete",key:{Eng:"DEL",Ru:"DEL"},shift:{Eng:null,Ru:null}},{type:"modifier",code:"CapsLock",key:{Eng:"CAPS LOCK",Ru:"CAPS LOCK"},shift:{Eng:null,Ru:null}},{type:"char",code:"KeyA",key:{Eng:"A",Ru:"Ф"},shift:{Eng:null,Ru:null}},{type:"char",code:"KeyS",key:{Eng:"S",Ru:"Ы"},shift:{Eng:null,Ru:null}},{type:"char",code:"KeyD",key:{Eng:"D",Ru:"В"},shift:{Eng:null,Ru:null}},{type:"char",code:"KeyF",key:{Eng:"F",Ru:"А"},shift:{Eng:null,Ru:null}},{type:"char",code:"KeyG",key:{Eng:"G",Ru:"П"},shift:{Eng:null,Ru:null}},{type:"char",code:"KeyH",key:{Eng:"H",Ru:"Р"},shift:{Eng:null,Ru:null}},{type:"char",code:"KeyJ",key:{Eng:"J",Ru:"О"},shift:{Eng:null,Ru:null}},{type:"char",code:"KeyK",key:{Eng:"K",Ru:"Л"},shift:{Eng:null,Ru:null}},{type:"char",code:"KeyL",key:{Eng:"L",Ru:"Д"},shift:{Eng:null,Ru:null}},{type:"char",code:"Semicolon",key:{Eng:";",Ru:"Ж"},shift:{Eng:":",Ru:null}},{type:"char",code:"Quote",key:{Eng:"'",Ru:"Э"},shift:{Eng:'"',Ru:null}},{type:"modifier",code:"Enter",key:{Eng:"ENTER",Ru:"ENTER"},shift:{Eng:null,Ru:null}},{type:"modifier",code:"ShiftLeft",key:{Eng:"SHIFT",Ru:"SHIFT"},shift:{Eng:null,Ru:null}},{type:"char",code:"KeyZ",key:{Eng:"Z",Ru:"Я"},shift:{Eng:null,Ru:null}},{type:"char",code:"KeyX",key:{Eng:"X",Ru:"Ч"},shift:{Eng:null,Ru:null}},{type:"char",code:"KeyC",key:{Eng:"C",Ru:"С"},shift:{Eng:null,Ru:null}},{type:"char",code:"KeyV",key:{Eng:"V",Ru:"М"},shift:{Eng:null,Ru:null}},{type:"char",code:"KeyB",key:{Eng:"B",Ru:"И"},shift:{Eng:null,Ru:null}},{type:"char",code:"KeyN",key:{Eng:"N",Ru:"Т"},shift:{Eng:null,Ru:null}},{type:"char",code:"KeyM",key:{Eng:"M",Ru:"Ь"},shift:{Eng:null,Ru:null}},{type:"char",code:"Comma",key:{Eng:",",Ru:"Б"},shift:{Eng:"<",Ru:null}},{type:"char",code:"Period",key:{Eng:".",Ru:"Ю"},shift:{Eng:">",Ru:null}},{type:"char",code:"Slash",key:{Eng:"/",Ru:"."},shift:{Eng:"?",Ru:","}},{type:"char",code:"ArrowUp",key:{Eng:"&#9650",Ru:"&#9650"},shift:{Eng:null,Ru:null}},{type:"modifier",code:"ShiftRight",key:{Eng:"SHIFT",Ru:"SHIFT"},shift:{Eng:null,Ru:null}},{type:"modifier",code:"ControlLeft",key:{Eng:"CTRL",Ru:"CTRL"},shift:{Eng:null,Ru:null}},{type:"modifier",code:"AltLeft",key:{Eng:"ALT",Ru:"ALT"},shift:{Eng:null,Ru:null}},{type:"modifier",code:"Space",key:{Eng:" ",Ru:" "},shift:{Eng:null,Ru:null}},{type:"modifier",code:"AltRight",key:{Eng:"ALT",Ru:"ALT"},shift:{Eng:null,Ru:null}},{type:"modifier",code:"ControlRight",key:{Eng:"CTRL",Ru:"CTRL"},shift:{Eng:null,Ru:null}},{type:"char",code:"ArrowLeft",key:{Eng:"&#9668",Ru:"&#9668"},shift:{Eng:null,Ru:null}},{type:"char",code:"ArrowDown",key:{Eng:"&#9660",Ru:"&#9660"},shift:{Eng:null,Ru:null}},{type:"char",code:"ArrowRight",key:{Eng:"&#9658",Ru:"&#9658"},shift:{Eng:null,Ru:null}},{type:"meta",code:"Fn",key:{Eng:"FN",Ru:"FN"},shift:{Eng:null,Ru:null}}];class t{constructor(e,t){this.type=e.type,this.code=e.code,this.key=e.key,this.shift=e.shift,this.capsState=t.capsState,this.shiftState=t.shiftState,this.ctrlState=t.ctrlState,this.altState=t.altState,this.langState=t.langState}createButton(){const e=document.createElement("button");return e.setAttribute("type","button"),e.setAttribute("data-code",this.code),e.classList.add("key__container"),"CapsLock"!==this.code||this.capsState?"CapsLock"===this.code&&this.capsState&&e.classList.add("key__caps","key__caps_active"):e.classList.add("key__caps"),this.capsState&&!this.shiftState?e.innerHTML=this.key[this.langState].toUpperCase():this.capsState&&this.shiftState?this.shift[this.langState]?e.innerHTML=this.shift[this.langState]:"char"===this.type?e.innerHTML=this.key[this.langState].toLowerCase():e.innerHTML=this.key[this.langState]:this.shiftState&&!this.shift[this.langState]?e.innerHTML=this.key[this.langState].toUpperCase():this.shiftState&&this.shift[this.langState]?e.innerHTML=this.shift[this.langState]:this.shiftState||"char"!==this.type?e.innerHTML=this.key[this.langState]:e.innerHTML=this.key[this.langState].toLowerCase(),e}}class n{constructor(e){this.nodeName=e.target.nodeName,this.newEventCode=e.target.dataset.code,this.type="",this.newEventValue="",this.eventInner=e.target.innerHTML,this.eventInnerType="",this.eventType=e.type}isTargetButton(){return"BUTTON"===this.nodeName}getInnerType(e){e.forEach((e=>{e.code===this.newEventCode&&(this.eventInnerType=e.type)}))}getNewEventValue(){"char"===this.eventInnerType||"digit"===this.eventInnerType?this.newEventValue=this.eventInner:"ENTER"===this.eventInner?this.newEventValue="\n":"TAB"===this.eventInner&&(this.newEventValue="  ")}getNewEventType(){"mousedown"===this.eventType?this.type="keydown":"mouseup"!==this.eventType&&"mouseout"!==this.eventType||(this.type="keyup")}}({elements:{main:null,textArea:null,title:null,description:null},init(){this.elements.main=document.createElement("div"),this.elements.textArea=document.createElement("textarea"),this.elements.title=document.createElement("div"),this.elements.description=document.createElement("p"),this.elements.description.classList.add("description"),this.elements.title.classList.add("title"),this.elements.main.classList.add("textarea"),this.elements.textArea.setAttribute("name","aim-area"),this.elements.textArea.setAttribute("autofocus",""),this.elements.title.innerHTML="RSS Virtual Keyboard",this.elements.description.innerHTML='Keyboard was made with OS Windows. Shortcut for change language: Ctrl+Alt. <br> Press "Fn" at virtual-keyboard to choose action for arrows (navigation of input symbols)',this.elements.main.append(this.elements.textArea),document.body.prepend(this.elements.main),document.body.prepend(this.elements.title),document.body.append(this.elements.description)}}).init();const s={elements:{main:null,mainContainer:null,keysContainer:null,keys:new Set,activeButtons:new Set,inputArea:document.querySelector("textarea")},properties:{value:"",capsState:!1,shiftState:!1,ctrlState:!1,altState:!1,langState:"Eng",cursorPosition:0,arrowState:"nav"},init(){this.elements.main=document.createElement("div"),this.elements.mainContainer=document.createElement("div"),this.elements.keysContainer=document.createElement("div"),this.elements.main.classList.add("keyboard"),this.elements.mainContainer.classList.add("keyboard__conteiner"),this.elements.keysContainer.classList.add("keyboard__keys","key","_wrapper"),this.elements.keysContainer.append(this.createKeys()),this.elements.mainContainer.append(this.elements.keysContainer),this.elements.main.append(this.elements.mainContainer),document.body.append(this.elements.main)},refresh(){this.elements.keysContainer=document.querySelector(".keyboard__keys"),this.elements.keysContainer.innerHTML="",this.elements.keysContainer.append(this.createKeys())},input(e){this.getCursorPosition(e.length),this.elements.inputArea.value=this.elements.inputArea.value.slice(0,s.properties.cursorPosition-1)+e+this.elements.inputArea.value.slice(s.properties.cursorPosition-1),this.setCursorPosition(0)},createKeys(){const n=document.createDocumentFragment();return e.forEach((e=>{const i=new t(e,this.properties),a=i.createButton();!function(e,t){switch(s.elements.activeButtons.has(e)&&t.classList.add("key_active"),e){case"Backspace":case"Enter":t.classList.add("key_blacked","key_size-l");break;case"ShiftLeft":case"ShiftRight":t.classList.add("key_blacked","key_size-xl");break;case"CapsLock":t.classList.add("key_blacked","key_size-xxm");break;case"Tab":case"Delete":case"Fn":t.classList.add("key_blacked","key_size-m");break;case"ControlLeft":case"ControlRight":t.classList.add("key_blacked","key_size-xm");break;case"ArrowUp":case"ArrowRight":case"ArrowLeft":case"ArrowDown":case"AltLeft":case"AltRight":case"Backquote":t.classList.add("key_blacked");break;case"Space":t.classList.add("key_size-xxl")}}(i.code,a),s.elements.keys.add(i.code),n.append(a)})),n},listen(){document.body.addEventListener("keydown",this.trigerKeyboardEvent),document.body.addEventListener("keyup",this.trigerKeyboardEvent),this.elements.inputArea.addEventListener("focusout",(()=>this.focusBack())),this.elements.keysContainer.addEventListener("mousedown",this.trigerMouseEvent),document.addEventListener("visibilitychange",(()=>this.windowFocusoutAction()))},focusBack(){s.elements.inputArea.focus(),this.setCursorPosition(0)},windowFocusoutAction(){this.elements.activeButtons.clear(),this.refresh()},trigerMouseEvent(t){const i=new n(t);if(i.isTargetButton()){i.getInnerType(e),i.getNewEventType(),"mousedown"===t.type?(s.elements.keysContainer.addEventListener("mouseout",s.trigerMouseEvent),s.elements.keysContainer.addEventListener("mouseup",s.trigerMouseEvent)):"mouseup"!==t.type&&"mouseout"!==t.type||(s.elements.keysContainer.removeEventListener("mouseup",s.trigerMouseEvent),s.elements.keysContainer.removeEventListener("mouseout",s.trigerMouseEvent));const n=new KeyboardEvent(i.type,{code:i.newEventCode});document.body.dispatchEvent(n)}},trigerKeyboardEvent(e){switch(s.makeButtonActive(e),e.code){case"ShiftLeft":case"ShiftRight":s.toggleShiftState(e);break;case"CapsLock":s.toggleCapsState(e);break;case"AltLeft":case"AltRight":e.preventDefault(),s.toggleAltState(e),s.toggleLangState();break;case"ControlLeft":case"ControlRight":s.toggleControlState(e),s.toggleLangState();break;case"Backspace":e.preventDefault(),s.backspaceAction(e);break;case"Delete":e.preventDefault(),s.deleteAction(e);break;case"Enter":case"Fn":case"Tab":e.preventDefault(),s.newKeyboardEvent(e);break;case"ArrowUp":e.preventDefault(),"nav"===s.properties.arrowState?s.moveCursorUp(e):s.newKeyboardEvent(e);break;case"ArrowRight":e.preventDefault(),"nav"===s.properties.arrowState?s.moveCursorRight(e):s.newKeyboardEvent(e);break;case"ArrowLeft":e.preventDefault(),"nav"===s.properties.arrowState?s.moveCursorLeft(e):s.newKeyboardEvent(e);break;case"ArrowDown":e.preventDefault(),"nav"===s.properties.arrowState?s.moveCursorDown(e):s.newKeyboardEvent(e);break;default:!s.properties.ctrlState&&s.elements.keys.has(e.code)&&(e.preventDefault(),s.newKeyboardEvent(e))}},deleteAction(e){if("keydown"===e.type){this.getCursorPosition(0);let e=0;const t=s.elements.inputArea.selectionStart,n=s.elements.inputArea.selectionEnd,{inputArea:i}=s.elements;e=t===n?n+1:n,i.value=i.value.slice(0,t)+i.value.slice(e),this.setCursorPosition(0)}},backspaceAction(e){if("keydown"===e.type){this.getCursorPosition(-1);let e=0;const t=s.elements.inputArea.selectionStart,n=s.elements.inputArea.selectionEnd,{inputArea:i}=s.elements;e=t===n?t-1:t,i.value=i.value.slice(0,e)+i.value.slice(n),this.setCursorPosition(0)}},moveCursorLeft(e){"keydown"===e.type&&(s.getCursorPosition(-1),s.setCursorPosition(0))},moveCursorUp(e){if("keydown"===e.type){s.getCursorPosition(0);const e=s.elements.inputArea.value.lastIndexOf("\n",s.properties.cursorPosition-1);s.properties.cursorPosition=e,s.setCursorPosition(0)}},moveCursorDown(e){if("keydown"===e.type){s.getCursorPosition(0);const e=s.elements.inputArea.value.indexOf("\n",s.properties.cursorPosition+1);s.properties.cursorPosition=e,s.setCursorPosition(0)}},moveCursorRight(e){"keydown"===e.type&&(s.getCursorPosition(1),s.setCursorPosition(0))},setCursorPosition(e){s.elements.inputArea.selectionStart=s.properties.cursorPosition+e,s.elements.inputArea.selectionEnd=s.properties.cursorPosition+e},getCursorPosition(e){s.properties.cursorPosition=s.elements.inputArea.selectionStart+e},newKeyboardEvent(e){if("keydown"===e.type){let t="";"Tab"===e.code?t="    ":"Enter"===e.code?t="\n":"Fn"===e.code?s.properties.arrowState="nav"===s.properties.arrowState?"text":"nav":t=document.querySelector(`button[data-code=${e.code}]`).innerHTML,s.input(t)}},toggleCapsState(e){"keydown"===e.type&&(!0===this.properties.capsState?this.properties.capsState=!1:this.properties.capsState=!0,s.refresh())},toggleShiftState(e){("keydown"===e.type||"keyup"===e.type)&&(!0===this.properties.shiftState?this.properties.shiftState=!1:this.properties.shiftState=!0),s.refresh()},toggleControlState(e){"keydown"===e.type?this.properties.ctrlState=!0:"keyup"===e.type&&(this.properties.ctrlState=!1)},toggleAltState(e){"keydown"===e.type?this.properties.altState=!0:"keyup"===e.type&&(this.properties.altState=!1)},toggleLangState(){this.properties.altState&&this.properties.ctrlState&&(this.properties.langState="Eng"===this.properties.langState?"Ru":"Eng",s.refresh()),s.setCurrentLang()},makeButtonActive(e){"keydown"===e.type?(s.elements.activeButtons.add(e.code),s.refresh()):"keyup"===e.type&&(s.elements.activeButtons.delete(e.code),s.refresh())},getCurrentLang(){localStorage.RSS_KSH_lang||(localStorage.RSS_KSH_lang="Eng"),s.properties.langState=localStorage.RSS_KSH_lang,s.refresh()},setCurrentLang(){localStorage.RSS_KSH_lang=this.properties.langState}};window.addEventListener("DOMContentLoaded",(()=>{s.init(),s.getCurrentLang(),s.listen()}))})();